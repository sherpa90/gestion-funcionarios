{% load static %}
<!DOCTYPE html>
<html lang="es" class="h-full bg-gray-50">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}SGPAL{% endblock %}</title>
    <script src="https://cdn.tailwindcss.com/?plugins=forms,typography,aspect-ratio,line-clamp"></script>
    <link href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css" rel="stylesheet" />
    <link rel="stylesheet" href="{% static 'core/vendor/fontawesome/css/all.min.css' %}">
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: {
                            50: '#eff6ff', 100: '#dbeafe', 200: '#bfdbfe', 300: '#93c5fd', 400: '#60a5fa',
                            500: '#3b82f6', 600: '#2563eb', 700: '#1d4ed8', 800: '#1e40af', 900: '#1e3a8a',
                        }
                    }
                }
            }
        }
    </script>
    <style>
        /* Estilos Base */
        * {
            transition: all 0.2s ease;
        }

        /* Select2 y Inputs */
        .select2-container--default .select2-selection--single {
            height: 44px;
            border: 2px solid #e5e7eb;
            border-radius: 0.75rem;
            padding: 0.625rem 1rem;
        }

        .select2-container--default .select2-selection--single .select2-selection__rendered {
            line-height: 28px;
            padding-left: 0;
            color: #1f2937;
        }

        .select2-container--default .select2-selection--single .select2-selection__arrow {
            height: 42px;
        }

        input,
        textarea,
        select {
            width: 100%;
            padding: 0.75rem 1rem;
            border: 2px solid #e5e7eb;
            border-radius: 0.75rem;
            background-color: #ffffff;
            color: #1f2937;
        }

        input:focus,
        select:focus,
        textarea:focus {
            outline: none;
            border-color: #3b82f6;
            box-shadow: 0 0 0 4px rgba(59, 130, 246, 0.1);
        }

        /* Sidebar Link Active */
        .sidebar-link.active {
            background-color: #2563eb;
            color: white;
        }

        /* Scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }

        ::-webkit-scrollbar-thumb {
            background: #cbd5e1;
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: #94a3b8;
        }
    </style>
</head>

<body class="h-full overflow-hidden">
    <div class="flex h-full">
        <aside class="w-64 bg-gray-900 text-white flex-shrink-0 hidden md:flex flex-col">
            <div class="h-16 flex items-center justify-center border-b border-gray-700">
                <div class="flex items-center space-x-2">
                    <i class="fas fa-clipboard-check text-2xl text-primary-400"></i>
                    <span class="text-xl font-bold">SGPAL</span>
                </div>
            </div>

            {% if user.is_authenticated %}

            <div class="p-4 border-b border-gray-700">
                <div class="flex items-center space-x-3">
                    <div class="w-10 h-10 rounded-full bg-primary-600 flex items-center justify-center">
                        <span class="text-sm font-semibold">{{ user.first_name.0 }}{{ user.last_name.0 }}</span>
                    </div>
                    <div class="flex-1 min-w-0">
                        <p class="text-sm font-medium truncate">{{ user.get_full_name }}</p>
                        <p class="text-xs text-gray-400 truncate">{{ user.get_role_display }}</p>
                    </div>
                </div>
            </div>

            <nav class="flex-1 overflow-y-auto py-4">
                <div class="px-3 space-y-1">
                    <a href="{% url 'dashboard' %}"
                        class="sidebar-link flex items-center px-3 py-2.5 text-sm font-medium rounded-lg hover:bg-gray-800">
                        <i class="fas fa-home w-5"></i><span class="ml-3">Dashboard</span>
                    </a>

                    <!-- Mis Liquidaciones - Disponible para todos los usuarios -->
                    <a href="{% url 'mis_liquidaciones' %}"
                        class="sidebar-link flex items-center px-3 py-2.5 text-sm font-medium rounded-lg hover:bg-gray-800">
                        <i class="fas fa-file-invoice-dollar w-5"></i><span class="ml-3">Mis Liquidaciones</span>
                    </a>

                    <!-- Mi Asistencia - Disponible para todos los usuarios -->
                    <a href="{% url 'asistencia:mi_asistencia' %}"
                        class="sidebar-link flex items-center px-3 py-2.5 text-sm font-medium rounded-lg hover:bg-gray-800">
                        <i class="fas fa-clock w-5"></i><span class="ml-3">Mi Asistencia</span>
                    </a>


                    {% if user.role == 'FUNCIONARIO' or user.role == 'ADMIN' %}
                    <a href="{% url 'solicitar_permiso' %}"
                        class="sidebar-link flex items-center px-3 py-2.5 text-sm font-medium rounded-lg hover:bg-gray-800">
                        <i class="fas fa-calendar-plus w-5"></i><span class="ml-3">Solicitar D√≠as</span>
                    </a>
                    <a href="{% url 'licencia_list' %}"
                        class="sidebar-link flex items-center px-3 py-2.5 text-sm font-medium rounded-lg hover:bg-gray-800">
                        <i class="fas fa-file-medical w-5"></i><span class="ml-3">Mis Licencias</span>
                    </a>
                    {% endif %}

                    {% if user.role == 'DIRECTOR' %}
                    <div class="pt-4 pb-2">
                        <p class="px-3 text-xs font-semibold text-gray-400 uppercase tracking-wider">Gesti√≥n</p>
                    </div>
                    <a href="{% url 'solicitudes_admin' %}"
                        class="sidebar-link flex items-center px-3 py-2.5 text-sm font-medium rounded-lg hover:bg-gray-800">
                        <i class="fas fa-tasks w-5"></i><span class="ml-3">Aprobar Solicitudes</span>
                    </a>
                    {% endif %}

                    {% if user.role|default:''|upper == 'ADMIN' or user.role|default:''|upper == 'SECRETARIA' %}
                    <!-- Gesti√≥n de Recursos Humanos -->
                    <div class="pt-4 pb-2">
                        <p class="px-3 text-xs font-semibold text-gray-400 uppercase tracking-wider">üë• Recursos Humanos</p>
                    </div>
                    <a href="{% url 'user_list' %}"
                        class="sidebar-link flex items-center px-3 py-2.5 text-sm font-medium rounded-lg hover:bg-gray-800">
                        <i class="fas fa-users w-5"></i><span class="ml-3">Usuarios</span>
                    </a>
                    <a href="{% url 'admin_management' %}"
                        class="sidebar-link flex items-center px-3 py-2.5 text-sm font-medium rounded-lg hover:bg-gray-800">
                        <i class="fas fa-calendar-check w-5"></i><span class="ml-3">Permisos</span>
                    </a>
                    <a href="{% url 'subir_licencia' %}"
                        class="sidebar-link flex items-center px-3 py-2.5 text-sm font-medium rounded-lg hover:bg-gray-800">
                        <i class="fas fa-notes-medical w-5"></i><span class="ml-3">Licencias</span>
                    </a>

                    <!-- Gesti√≥n Financiera -->
                    <div class="pt-4 pb-2">
                        <p class="px-3 text-xs font-semibold text-gray-400 uppercase tracking-wider">üí∞ Gesti√≥n Financiera</p>
                    </div>
                    <a href="{% url 'admin_liquidaciones_overview' %}"
                        class="sidebar-link flex items-center px-3 py-2.5 text-sm font-medium rounded-lg hover:bg-gray-800">
                        <i class="fas fa-file-invoice-dollar w-5"></i><span class="ml-3">Liquidaciones</span>
                    </a>

                    <!-- Control de Asistencia -->
                    <div class="pt-4 pb-2">
                        <p class="px-3 text-xs font-semibold text-gray-400 uppercase tracking-wider">‚è∞ Control de Asistencia</p>
                    </div>
                    <a href="{% url 'asistencia:gestion_horarios' %}"
                        class="sidebar-link flex items-center px-3 py-2.5 text-sm font-medium rounded-lg hover:bg-gray-800">
                        <i class="fas fa-user-clock w-5"></i><span class="ml-3">Horarios</span>
                    </a>
                    <a href="{% url 'asistencia:carga_horarios' %}"
                        class="sidebar-link flex items-center px-3 py-2.5 text-sm font-medium rounded-lg hover:bg-gray-800">
                        <i class="fas fa-upload w-5"></i><span class="ml-3">Cargar Horarios</span>
                    </a>
                    <a href="{% url 'asistencia:gestion_asistencia' %}"
                        class="sidebar-link flex items-center px-3 py-2.5 text-sm font-medium rounded-lg hover:bg-gray-800">
                        <i class="fas fa-clipboard-list w-5"></i><span class="ml-3">Ver Asistencia</span>
                    </a>
                    <a href="{% url 'asistencia:carga_registros' %}"
                        class="sidebar-link flex items-center px-3 py-2.5 text-sm font-medium rounded-lg hover:bg-gray-800">
                        <i class="fas fa-file-upload w-5"></i><span class="ml-3">Cargar Registros</span>
                    </a>

                    <!-- Gesti√≥n de Alegaciones -->
                    <a href="{% url 'asistencia:gestion_alegaciones' %}"
                        class="sidebar-link flex items-center px-3 py-2.5 text-sm font-medium rounded-lg hover:bg-gray-800">
                        <i class="fas fa-exclamation-triangle w-5"></i><span class="ml-3">Alegaciones</span>
                    </a>

                    <!-- Gesti√≥n de D√≠as Festivos -->
                    <a href="{% url 'asistencia:gestion_festivos' %}"
                        class="sidebar-link flex items-center px-3 py-2.5 text-sm font-medium rounded-lg hover:bg-gray-800">
                        <i class="fas fa-calendar-star w-5"></i><span class="ml-3">D√≠as Festivos</span>
                    </a>

                    <!-- Reportes y Estad√≠sticas -->
                    <div class="pt-4 pb-2">
                        <p class="px-3 text-xs font-semibold text-gray-400 uppercase tracking-wider">üìä Reportes</p>
                    </div>
                    {% if user.role == 'ADMIN' %}
                    <a href="{% url 'admin_dashboard:dashboard' %}"
                        class="sidebar-link flex items-center px-3 py-2.5 text-sm font-medium rounded-lg hover:bg-gray-800">
                        <i class="fas fa-tachometer-alt w-5"></i><span class="ml-3">Estad√≠sticas</span>
                    </a>
                    {% endif %}
                    {% if user.role == 'SECRETARIA' or user.role == 'ADMIN' or user.role == 'DIRECTOR' or user.role == 'DIRECTIVO' %}
                    <a href="{% url 'reportes' %}"
                        class="sidebar-link flex items-center px-3 py-2.5 text-sm font-medium rounded-lg hover:bg-gray-800">
                        <i class="fas fa-chart-line w-5"></i><span class="ml-3">Reportes</span>
                    </a>
                    {% endif %}
                    {% endif %}
                </div>
            </nav>

            <div class="p-4 border-t border-gray-700">
                <form action="{% url 'logout' %}" method="post">
                    {% csrf_token %}
                    <button type="submit"
                        class="w-full flex items-center px-3 py-2.5 text-sm font-medium rounded-lg hover:bg-red-600 text-gray-300 hover:text-white">
                        <i class="fas fa-sign-out-alt w-5"></i><span class="ml-3">Cerrar Sesi√≥n</span>
                    </button>
                </form>
            </div>

            {% endif %}
        </aside>

        <div class="flex-1 flex flex-col overflow-hidden">
            <header class="h-14 sm:h-16 bg-white border-b border-gray-200 flex items-center justify-between px-4 sm:px-6">
                <div class="flex items-center min-w-0 flex-1">
                    <button id="mobile-menu-button" class="md:hidden text-gray-500 hover:text-gray-700 p-2 -ml-2">
                        <i class="fas fa-bars text-lg"></i>
                    </button>
                    <h1 class="text-lg sm:text-xl font-semibold text-gray-800 ml-2 sm:ml-4 md:ml-0 truncate">{% block page_title %}Dashboard{% endblock %}</h1>
                </div>
                <!-- Espacio para futuras acciones del header -->
                <div class="flex items-center space-x-2">
                    <!-- Aqu√≠ pueden ir notificaciones, perfil, etc. -->
                </div>
            </header>

            {% if messages %}
            <div class="px-4 sm:px-6 pt-3 sm:pt-4">
                {% for message in messages %}
                <div
                    class="mb-3 p-3 sm:p-4 rounded-lg shadow-sm {% if message.tags == 'error' %}bg-red-50 text-red-800 border border-red-200{% else %}bg-blue-50 text-blue-800 border border-blue-200{% endif %}">
                    <div class="flex items-start">
                        <i class="fas fa-info-circle mr-2 sm:mr-3 mt-0.5 flex-shrink-0"></i>
                        <span class="text-sm sm:text-base">{{ message }}</span>
                    </div>
                </div>
                {% endfor %}
            </div>
            {% endif %}

            <main class="flex-1 overflow-y-auto bg-gray-50">
                {% block content %}{% endblock %}
            </main>
        </div>
    </div>

    <div id="mobile-menu" class="hidden fixed inset-0 z-50 md:hidden">
        <div class="absolute inset-0 bg-gray-600 opacity-75" id="mobile-menu-overlay"></div>
        <aside class="absolute left-0 top-0 bottom-0 w-64 bg-gray-900 text-white flex flex-col">
            <div class="h-16 flex items-center justify-between px-4 border-b border-gray-700">
                <div class="flex items-center space-x-2">
                    <i class="fas fa-clipboard-check text-2xl text-primary-400"></i>
                    <span class="text-xl font-bold">SGPAL</span>
                </div>
                <button id="mobile-menu-close" class="text-gray-400 hover:text-white">
                    <i class="fas fa-times text-xl"></i>
                </button>
            </div>
            <div class="p-4 border-b border-gray-700">
                <div class="flex items-center space-x-3">
                    <div class="w-10 h-10 rounded-full bg-primary-600 flex items-center justify-center">
                        <span class="text-sm font-semibold">{{ user.first_name.0 }}{{ user.last_name.0 }}</span>
                    </div>
                    <div class="flex-1 min-w-0">
                        <p class="text-sm font-medium truncate">{{ user.get_full_name }}</p>
                        <p class="text-xs text-gray-400 truncate">{{ user.get_role_display }}</p>
                    </div>
                </div>
            </div>

            <nav class="flex-1 overflow-y-auto py-4">
                <div class="px-3 space-y-1">
                    <a href="{% url 'dashboard' %}"
                        class="sidebar-link flex items-center px-3 py-2.5 text-sm font-medium rounded-lg hover:bg-gray-800">
                        <i class="fas fa-home w-5"></i><span class="ml-3">Dashboard</span>
                    </a>

                    <!-- Mis Liquidaciones - Disponible para todos los usuarios -->
                    <a href="{% url 'mis_liquidaciones' %}"
                        class="sidebar-link flex items-center px-3 py-2.5 text-sm font-medium rounded-lg hover:bg-gray-800">
                        <i class="fas fa-file-invoice-dollar w-5"></i><span class="ml-3">Mis Liquidaciones</span>
                    </a>

                    {% if user.role == 'FUNCIONARIO' or user.role == 'ADMIN' %}
                    <a href="{% url 'solicitar_permiso' %}"
                        class="sidebar-link flex items-center px-3 py-2.5 text-sm font-medium rounded-lg hover:bg-gray-800">
                        <i class="fas fa-calendar-plus w-5"></i><span class="ml-3">Solicitar D√≠as</span>
                    </a>
                    <a href="{% url 'licencia_list' %}"
                        class="sidebar-link flex items-center px-3 py-2.5 text-sm font-medium rounded-lg hover:bg-gray-800">
                        <i class="fas fa-file-medical w-5"></i><span class="ml-3">Mis Licencias</span>
                    </a>
                    {% endif %}
                    {% if user.role == 'DIRECTOR' %}
                    <a href="{% url 'solicitudes_admin' %}"
                        class="sidebar-link flex items-center px-3 py-2.5 text-sm font-medium rounded-lg hover:bg-gray-800">
                        <i class="fas fa-tasks w-5"></i><span class="ml-3">Aprobar Solicitudes</span>
                    </a>
                    {% endif %}
                    {% if user.role|default:''|upper == 'ADMIN' or user.role|default:''|upper == 'SECRETARIA' %}
                    <!-- Gesti√≥n de Recursos Humanos -->
                    <div class="pt-4 pb-2">
                        <p class="px-3 text-xs font-semibold text-gray-400 uppercase tracking-wider">üë• Recursos Humanos</p>
                    </div>
                    <a href="{% url 'user_list' %}"
                        class="sidebar-link flex items-center px-3 py-2.5 text-sm font-medium rounded-lg hover:bg-gray-800">
                        <i class="fas fa-users w-5"></i><span class="ml-3">Usuarios</span>
                    </a>
                    <a href="{% url 'admin_management' %}"
                        class="sidebar-link flex items-center px-3 py-2.5 text-sm font-medium rounded-lg hover:bg-gray-800">
                        <i class="fas fa-calendar-check w-5"></i><span class="ml-3">Permisos</span>
                    </a>
                    <a href="{% url 'subir_licencia' %}"
                        class="sidebar-link flex items-center px-3 py-2.5 text-sm font-medium rounded-lg hover:bg-gray-800">
                        <i class="fas fa-notes-medical w-5"></i><span class="ml-3">Licencias</span>
                    </a>

                    <!-- Gesti√≥n Financiera -->
                    <div class="pt-4 pb-2">
                        <p class="px-3 text-xs font-semibold text-gray-400 uppercase tracking-wider">üí∞ Gesti√≥n Financiera</p>
                    </div>
                    <a href="{% url 'admin_liquidaciones_overview' %}"
                        class="sidebar-link flex items-center px-3 py-2.5 text-sm font-medium rounded-lg hover:bg-gray-800">
                        <i class="fas fa-file-invoice-dollar w-5"></i><span class="ml-3">Liquidaciones</span>
                    </a>

                    <!-- Control de Asistencia -->
                    <div class="pt-4 pb-2">
                        <p class="px-3 text-xs font-semibold text-gray-400 uppercase tracking-wider">‚è∞ Control de Asistencia</p>
                    </div>
                    <a href="{% url 'asistencia:gestion_horarios' %}"
                        class="sidebar-link flex items-center px-3 py-2.5 text-sm font-medium rounded-lg hover:bg-gray-800">
                        <i class="fas fa-user-clock w-5"></i><span class="ml-3">Horarios</span>
                    </a>
                    <a href="{% url 'asistencia:carga_horarios' %}"
                        class="sidebar-link flex items-center px-3 py-2.5 text-sm font-medium rounded-lg hover:bg-gray-800">
                        <i class="fas fa-upload w-5"></i><span class="ml-3">Cargar Horarios</span>
                    </a>
                    <a href="{% url 'asistencia:gestion_asistencia' %}"
                        class="sidebar-link flex items-center px-3 py-2.5 text-sm font-medium rounded-lg hover:bg-gray-800">
                        <i class="fas fa-clipboard-list w-5"></i><span class="ml-3">Ver Asistencia</span>
                    </a>
                    <a href="{% url 'asistencia:carga_registros' %}"
                        class="sidebar-link flex items-center px-3 py-2.5 text-sm font-medium rounded-lg hover:bg-gray-800">
                        <i class="fas fa-file-upload w-5"></i><span class="ml-3">Cargar Registros</span>
                    </a>

                    <!-- Reportes y Estad√≠sticas -->
                    <div class="pt-4 pb-2">
                        <p class="px-3 text-xs font-semibold text-gray-400 uppercase tracking-wider">üìä Reportes</p>
                    </div>
                    {% if user.role == 'ADMIN' %}
                    <a href="{% url 'admin_dashboard:dashboard' %}"
                        class="sidebar-link flex items-center px-3 py-2.5 text-sm font-medium rounded-lg hover:bg-gray-800">
                        <i class="fas fa-tachometer-alt w-5"></i><span class="ml-3">Estad√≠sticas</span>
                    </a>
                    {% endif %}
                    {% if user.role == 'SECRETARIA' or user.role == 'ADMIN' or user.role == 'DIRECTOR' or user.role == 'DIRECTIVO' %}
                    <a href="{% url 'reportes' %}"
                        class="sidebar-link flex items-center px-3 py-2.5 text-sm font-medium rounded-lg hover:bg-gray-800">
                        <i class="fas fa-chart-line w-5"></i><span class="ml-3">Reportes</span>
                    </a>
                    {% endif %}
                    {% endif %}
                </div>
            </nav>
            <div class="p-4 border-t border-gray-700">
                <form action="{% url 'logout' %}" method="post">
                    {% csrf_token %}
                    <button type="submit"
                        class="w-full flex items-center px-3 py-2.5 text-sm font-medium rounded-lg hover:bg-red-600 text-gray-300 hover:text-white">
                        <i class="fas fa-sign-out-alt w-5"></i><span class="ml-3">Cerrar Sesi√≥n</span>
                    </button>
                </form>
            </div>
        </aside>
    </div>

    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>
    <script>
        $(document).ready(function () {
            $('select[name="usuario"]').select2({
                placeholder: 'Buscar usuario...', allowClear: true, width: '100%'
            });
            $('#mobile-menu-button').click(function () { $('#mobile-menu').removeClass('hidden'); });
            $('#mobile-menu-close, #mobile-menu-overlay').click(function () { $('#mobile-menu').addClass('hidden'); });

            const currentPath = window.location.pathname;
            $('.sidebar-link').each(function () {
                if ($(this).attr('href') === currentPath) { $(this).addClass('active'); }
            });
        });
    </script>
</body>

</html>